const asyncHandler = require("../util/asyncHandler");
const { validationResult } = require("express-validator");
const Place = require("../models/Place");

const HttpError = require("../models/http-error");

// GET Get place by place id
const getPlaceById = asyncHandler(async (req, res, next) => {
  const placeId = req.params.pid;

  const place = await Place.findById(placeId);

  if (!place) {
    throw new HttpError("Could not find a place for the provided id.", 404);
  }

  return res.json({ place });
});

// GET Get places by user id
const getPlacesByUserId = asyncHandler(async (req, res, next) => {
  const userId = req.params.uid;
  console.log(userId);
  const places = await Place.find({ creator: userId });

  if (!places || places.length === 0) {
    return next(
      new HttpError("Could not find places for the provided user id.", 404)
    );
  }

  return res.json({ places });
});

//POST Create place
const createPlace = asyncHandler(async (req, res, next) => {
  const errors = validationResult(req);
  if (!errors.isEmpty()) {
    return next(
      new HttpError("Invalid inputs passed, please check your data.", 422)
    );
  }
  const { title, description, address } = req.body;

  const place = await Place.create({
    title,
    description,
    address,
    creator: req.user.id,
    image: 'data:image/jpeg;base64,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'
  });
  return res.status(201).json({ place });
});

//PATCH Update place by id
const updatePlace = asyncHandler(async (req, res, next) => {
  const errors = validationResult(req);
  if (!errors.isEmpty()) {
    throw new HttpError("Invalid inputs passed, please check your data.", 422);
  }

  const placeId = req.params.pid;
  let place = await Place.findById(placeId);

  if (place.creator.toString() !== req.user.id) {
    throw new HttpError("You can't update this bootcamp", 401);
  }
  place = await Place.findByIdAndUpdate(placeId, req.body, {
    runValidators: true,
    new: true,
  });

  return res.status(200).json({ place });
});

//DELETE Delete place by id
const deletePlace = asyncHandler(async (req, res, next) => {
  const placeId = req.params.pid;
  const place = await Place.findById(placeId);
  if (place.creator.toString() !== req.user.id) {
    throw new HttpError("You can't delete this bootcamp", 401);
  }

  await Place.findByIdAndRemove(placeId);
  return res.status(200).json({ message: "Deleted place." });
});

exports.getPlaceById = getPlaceById;
exports.getPlacesByUserId = getPlacesByUserId;
exports.createPlace = createPlace;
exports.updatePlace = updatePlace;
exports.deletePlace = deletePlace;
